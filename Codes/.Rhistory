geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "grey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "grey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "grey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "grey")+
theme( axis.text=element_text(size=12)
,axis.title=element_text(size=14)
,legend.text=element_text(size=15)
,legend.title=element_text(size=15)
,legend.key.size=unit(1, "cm"))+
scale_size_continuous(range = c(3, 15),name="Gaugings / year")+
coord_cartesian(ylim=c(2000,16000))
IC_AmaxBandes
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "lightgrey")+
geom_text(aes(x = 2000, y = 15000, label = "blabla"))
IC_AmaxBandes
2020-25
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "lightgrey")+
geom_text(aes(x = 1995, y = 15250, label = "50 years", fontface = 2))
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "lightgrey")+
geom_text(aes(x = 1995, y = 15250, label = "50 years", fontface = 2))+
theme( axis.text=element_text(size=12)
,axis.title=element_text(size=14)
,legend.text=element_text(size=15)
,legend.title=element_text(size=15)
,legend.key.size=unit(1, "cm"))+
scale_size_continuous(range = c(3, 15),name="Gaugings / year")+
coord_cartesian(ylim=c(2000,16000))
IC_AmaxBandes
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "lightgrey")+
geom_text(aes(x = 1995, y = 15250, label = "50 years", fontface = 2), size = 4)+
theme( axis.text=element_text(size=12)
,axis.title=element_text(size=14)
,legend.text=element_text(size=15)
,legend.title=element_text(size=15)
,legend.key.size=unit(1, "cm"))+
scale_size_continuous(range = c(3, 15),name="Gaugings / year")+
coord_cartesian(ylim=c(2000,16000))
IC_AmaxBandes
16100-15600
16100+250
15600+250
16200+250
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "lightgrey")+
geom_text(aes(x = 1995, y = 15250, label = "50 years", fontface = 2), size = 5)+
geom_text(aes(x = 1995, y = 15850, label = "100 years", fontface = 2), size = 5)+
geom_text(aes(x = 1995, y = 16450, label = "150 years", fontface = 2), size = 5)+
geom_text(aes(x = 1995, y = 17050, label = "205 years", fontface = 2), size = 5)+
theme( axis.text=element_text(size=12)
,axis.title=element_text(size=14)
,legend.text=element_text(size=15)
,legend.title=element_text(size=15)
,legend.key.size=unit(1, "cm"))+
scale_size_continuous(range = c(3, 15),name="Gaugings / year")+
coord_cartesian(ylim=c(2000,16000))
IC_AmaxBandes
pdf(paste0(dir.plots,"IC_AMAX_Both_Bands.pdf"),16)
print(IC_Amax)
dev.off()
dir.plots
pdf(paste0(dir.plots,"IC_AMAX_Both_Bands.pdf"),16)
print(IC_AmaxBandes)
dev.off()
poly1 = data.frame(x = c(2020-50,2020,2020,2020-50),
y = c(15000,15000,15500,15500))
poly2 = data.frame(x = c(2020-100,2020,2020,2020-100),
y = c(15600,15600,16100,16100))
poly3 = data.frame(x = c(2020-150,2020,2020,2020-150),
y = c(16200,16200,16700,16700))
poly4 = data.frame(x = c(1816,2020,2020,1816),
y = c(16800,16800,17300,17300))
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "lightgrey")+
geom_text(aes(x = 1995, y = 15250, label = "50 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 15850, label = "100 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 16450, label = "150 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 17050, label = "205 years", fontface = 2), size = 4)+
theme( axis.text=element_text(size=12)
,axis.title=element_text(size=14)
,legend.text=element_text(size=15)
,legend.title=element_text(size=15)
,legend.key.size=unit(1, "cm"))+
scale_size_continuous(range = c(3, 15),name="Gaugings / year")+
coord_cartesian(ylim=c(2000,16000))
pdf(paste0(dir.plots,"IC_AMAX_Both_Bands.pdf"),16)
print(IC_AmaxBandes)
dev.off()
rm(list=ls())
dev.off()
source("C://Users/mathieu.lucas/Desktop/GitMat/PropagMaxAn/Codes/dirs.R")
source(paste0(dir.codes,"module_BaRatin.r"))
source(paste0(dir.codes,"Fun_SPD.r"))
case1 = "Pt"
case2 = "Res-Loc"
######################################
############ DATA LOADING ############
######################################
Spagtot1 = read.table(paste0(dir.res,case1,"/TotSpagsAMAX_",case1,".txt"),header = T)
Quants1 = read.table(paste0(dir.res,case1,"/Quantiles_Amax",case1,".txt"), header = T)
Spagtot2 = read.table(paste0(dir.res,case2,"/TotSpagsAMAX_Res.txt"), header = T)
Quants2 = read.table(paste0(dir.res,case2,"/Quantiles_AmaxRes.txt"), header = T)
Gau1 = data.frame(Date = ymd(read.csv2(paste0(dir.data,"JauBeaucaireOLD.csv"))[,1]), Y = NA)
Gau2 = data.frame(Date = ymd(read.csv2(paste0(dir.data,"JauBeaucaireCNR.csv"),header=T)[,1]), Y = NA)
Tshifts1 = c(as.Date("1840-11-02"),
as.Date("1816-05-15")+read.table(paste0(dir.data,"shift_timesPt.txt"),header=T)[,2])
Tshifts2 = as.Date(c("1976-11-11","1994-01-09","2002-11-28","2003-12-05","2004-07-15","2004-12-03",
"2005-12-24","2008-06-28","2009-10-20","2016-11-24"))
######################################
######### DATA FORMATTING ############
######################################
### 3 missing years = annuaire hydro + ic +/- sd(10%)
Miss = data.frame(an = 1968:1970, mp = c(4760,4995,5510), mp2.5=NA,mp97.5=NA,param2.5=NA,param97.5=NA,
tot2.5 = NA , tot97.5 =NA)
Miss$tot2.5 = qnorm(0.025,Miss$mp,(0.1*Miss$mp)) ; Miss$tot97.5 = qnorm(0.975,Miss$mp,(0.1*Miss$mp))
MissNoisy = rbind(  rnorm(n = 500, mean = Miss$mp[1], sd = 0.1*Miss$mp[1]),
rnorm(n = 500, mean = Miss$mp[2], sd = 0.1*Miss$mp[2]),
rnorm(n = 500, mean = Miss$mp[3], sd = 0.1*Miss$mp[3]) )
# combining both stations data
Tshifts = c(Tshifts1,Tshifts2)
Quants = rbind(Quants1,Miss,Quants2)
Spags = rbind(Spagtot1, MissNoisy, Spagtot2)
Gau = rbind(Gau1, Gau2)
Gau$Y = year(Gau$Date)
# number of gaugings by year for plots
Njau = 1816 : 2020
for(i in 1816 : 2020){Njau[i-1815] = length(which(Gau$Y==i))}
Njau[which(Njau==0)] = NA
poly1 = data.frame(x = c(2020-50,2020,2020,2020-50),
y = c(15000,15000,15500,15500))
poly2 = data.frame(x = c(2020-100,2020,2020,2020-100),
y = c(15600,15600,16100,16100))
poly3 = data.frame(x = c(2020-150,2020,2020,2020-150),
y = c(16200,16200,16700,16700))
poly4 = data.frame(x = c(1816,2020,2020,1816),
y = c(16800,16800,17300,17300))
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "lightgrey")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "lightgrey")+
geom_text(aes(x = 1995, y = 15250, label = "50 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 15850, label = "100 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 16450, label = "150 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 17050, label = "205 years", fontface = 2), size = 4)+
theme( axis.text=element_text(size=12)
,axis.title=element_text(size=14)
,legend.text=element_text(size=15)
,legend.title=element_text(size=15)
,legend.key.size=unit(1, "cm"))+
scale_size_continuous(range = c(3, 15),name="Gaugings / year")+
coord_cartesian(ylim=c(2000,16000))
#
# pdf(paste0(dir.plots,"IC_AMAX_Both_Bands.pdf"),16)
#   print(IC_AmaxBandes)
# dev.off()
### Floods w ic
Floods = Quants[which(Quants$mp>9000),]
Floods = Floods[order(Floods$mp),]
Floods$rank = seq_along(Floods$an)
Floods[13,3] = Floods[13,5]
Ggflood = ggplot(data = Floods)+
geom_errorbar(aes(x = rank, ymin = tot2.5, ymax = tot97.5, color = "3 - Remnant uncertainty"),# color ="#f03b20",
width = 0.3, lwd = 3)+
geom_errorbar(aes(x = rank, ymin = param2.5, ymax = param97.5, color = "2 - Paramtric uncertainty"), #color = "#fa9fb5",
width = 0, lwd = 3)+
geom_errorbar(aes(x = rank, ymin = mp2.5, ymax = mp97.5, color = "1 - Limnimetric uncertainty"),# color =  "#fec44f",
width = 0, lwd = 3)+
geom_point(aes(x = rank, y = mp, color = "4 - Maxpost"), size = 3)+
scale_color_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","black"))+
theme_bw(base_size = 20)+
scale_y_continuous(name = expression(paste("Discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
scale_x_continuous(breaks = Floods$rank, labels = Floods$an, name = "Year")+
coord_cartesian(ylim = c(8500,14500))+
theme(legend.position = c(0.15, 0.89))
print(IC_AmaxBandes)
IC_AmaxBandes = ggplot()+
scale_x_continuous(name = expression("Year"), expand=c(0,2))+
scale_y_continuous(name = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep="")),
expand=c(0.1,0))+
labs(x = "Time [day]", y = expression(paste("Annual maximum discharge [",m^3,".",s^-1,"]",sep=""))) +
theme_bw(base_size=15)+
geom_ribbon(data = Quants,
aes(x = an, ymin = tot2.5, ymax = tot97.5,#),
fill= "3-Remnant uncertainty"))+  #, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = param2.5, ymax = param97.5,#),
fill= "2-Parametric uncertainty"), alpha = 0.9)+#, show.legend = T)+
geom_ribbon(data = Quants,
aes(x = an, ymin = mp2.5, ymax = mp97.5,#),
fill="1-Limnimetric uncertainty"))+#, alpha = 0.5,show.legend = T)+
geom_ribbon(data = Quants[which(Quants$an >= 1967 & Quants$an <= 1971),], aes(x = an,
ymin = tot2.5, ymax= tot97.5, fill = "4 - Reconstructed") )+
geom_line(data = Quants, aes(x = an, y = mp))+
geom_point(aes(x = 1816 : 2020,y = 2000,size = Njau),color='blue',alpha = 0.5)+
geom_vline(xintercept = year(Tshifts),show.legend = T, linetype = 2, size = 0.8, color = "lightgrey")+
theme(legend.position = "right")+#,legend.text = element_text(size=8))+
scale_fill_manual(name = element_blank(),
values = c("#fec44f","#fa9fb5","#f03b20","grey"))+
geom_polygon(data = poly1, aes(x=x,y=y), fill = "#a1d76a")+
geom_polygon(data = poly2, aes(x=x,y=y), fill = "#a1d76a")+
geom_polygon(data = poly3, aes(x=x,y=y), fill = "#a1d76a")+
geom_polygon(data = poly4, aes(x=x,y=y), fill = "#a1d76a")+
geom_text(aes(x = 1995, y = 15250, label = "50 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 15850, label = "100 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 16450, label = "150 years", fontface = 2), size = 4)+
geom_text(aes(x = 1995, y = 17050, label = "205 years", fontface = 2), size = 4)+
theme( axis.text=element_text(size=12)
,axis.title=element_text(size=14)
,legend.text=element_text(size=15)
,legend.title=element_text(size=15)
,legend.key.size=unit(1, "cm"))+
scale_size_continuous(range = c(3, 15),name="Gaugings / year")+
coord_cartesian(ylim=c(2000,16000))
print(IC_AmaxBandes)
#
pdf(paste0(dir.plots,"IC_AMAX_Both_Bands.pdf"),16)
print(IC_AmaxBandes)
dev.off()
pdf(paste0(dir.plots,"IC_AMAX_Both_Bands.pdf"),16)
print(IC_AmaxBandes)
dev.off()
rm(list=ls())
dev.off()
source("C://Users/mathieu.lucas/Desktop/GitMat/PropagMaxAn/Codes/dirs.R")
# set.seed(42)
#######
####### DATA LOADING AND FORMATTING
# Data Bcr Restit
H_hor=read.csv2(paste0(dir.data,"/BcrResHorCor.csv"),header=T)
H_hor$Date = ymd_hms(H_hor$Date)
H_hor$Day = as_date(H_hor$Date)
H_hor$Time = hour(H_hor$Date)
H_hor$y = year(H_hor$Date)
# without 01-01-2021
H_hor = H_hor[-(nrow(H_hor)),]
# Data Pt Bcr
LimniPt = read.csv2(paste0(dir.data,"PtBcrJournalier.csv"))
LimniPt$Date = ymd(LimniPt$Date)
LimniPt$H = as.numeric(LimniPt$H)
#GradPt = LimniPt$H[-1] - LimniPt$H[-nrow(LimniPt)]
#######
### ERROR MODEL FITTING BASED ON BCR RESTITUTION STATION
# True daily max of bcr restit
MaxJ = aggregate(x = H_hor$H, by = list(H_hor$Day), FUN = max)
names(MaxJ) = c("day","h")
# 12h stage maxima
Midi = H_hor[which(H_hor$Time==12),c(3,2)]
# 3 stages/day maxima (7,12,18)
Three = H_hor[which(H_hor$Time==7 | H_hor$Time==12 | H_hor$Time==18),c(3,2)]
MaxThree = aggregate(x=Three$H, by = list(Three$Day), FUN=max)
names(MaxThree) = c("day","h")
# Residuals between measured and true maxima
DifMid = MaxJ$h - Midi$H
DifThree = MaxJ$h - MaxThree$h
#######
#### Annual maxima selection
#init DF
MaxARestit = data.frame(Y = unique(year(H_hor$Date)), h = NA,
Date = as.Date("1970-01-01"),Emid = NA, Ethree = NA)
#loop on all years
for(years in unique(H_hor$y)){
#indice of the max
indmax = which(H_hor$y == years)[which.max(H_hor$H[which(H_hor$y == years)])]
#stage max
MaxARestit$h[which(MaxARestit$Y == years)] = H_hor$H[indmax]
#stage day
MaxARestit$Date[which(MaxARestit$Y == years)] = H_hor$Day[indmax]
#1/d error of the max (true daily max - 12h stage)
MaxARestit$Emid[which(MaxARestit$Y == years)] = max(H_hor$H[which(H_hor$Day == H_hor$Day[indmax])]) -
H_hor$H[which(H_hor$Day == H_hor$Day[indmax])][13]
#3/d error of the max (true daily max - max(7,12,18) stage)
MaxARestit$Ethree[which(MaxARestit$Y == years)] = max(H_hor$H[which(H_hor$Day == H_hor$Day[indmax])]) -
max(H_hor$H[which(H_hor$Day == H_hor$Day[indmax])][c(8,13,19)])
}
#######
## LOGNORM or EXP fit on annual max stage errors + plot
# pdf(file = paste0(dir.plots,"FitsMaxAstage_BcrRestit.pdf"),width = 6,height = 10)
# layout(matrix(1:8, nrow = 4, ncol = 2))
xtheo = seq(0,4,0.01)
br = 20
#EXP FIT 1/D
E1 = mean(MaxARestit$Emid,na.rm=T)
lamb1 = 1/E1
hist(MaxARestit$Emid,prob = T, main = "Exponential 1/d",ylim = c(0,3),
breaks = br, xlab = "Stage error [m]")
ytheo = dexp(xtheo,lamb1);lines(xtheo, ytheo,col="deepskyblue",lwd=3)
q_theo=qexp((1:length(MaxARestit$Emid))/length(MaxARestit$Emid),lamb1)
qqplot(q_theo,MaxARestit$Emid,xlim = c(0,3),ylim=c(0,4),col="deepskyblue",ylab="Stage error [m]")
abline(a=0,b=1, col="red")
#EXP FIT 3/D
E3 = mean(MaxARestit$Ethree,na.rm=T)
lamb3 = 1/E3
hist(MaxARestit$Ethree,prob = T, main = "Exponential 3/d",ylim = c(0,15),
breaks = br,xlab = "Stage error [m]")
ytheo = dexp(xtheo,lamb3);lines(xtheo, ytheo,col="deepskyblue",lwd=3)
q_theo=qexp((1:length(MaxARestit$Ethree))/length(MaxARestit$Ethree),lamb3)
qqplot(q_theo,MaxARestit$Ethree,xlim = c(0,1),ylim=c(0,1),col="deepskyblue",ylab="Stage error [m]")
abline(a=0,b=1, col="red")
mu1 = mean(log(MaxARestit$Emid)[which(log(MaxARestit$Emid)!=-Inf)])
sigma1 = sd(log(MaxARestit$Emid)[which(log(MaxARestit$Emid)!=-Inf)])
hist(MaxARestit$Emid,prob = T,ylim=c(0,3),main = "LogNorm 1/d",
breaks = br,xlab = "Stage error [m]")
ytheo = dlnorm(xtheo,mu1,sigma1)
lines(xtheo, ytheo,col="blue",lwd=3)
q_theo=qlnorm((1:length(MaxARestit$Emid))/length(MaxARestit$Emid),mu1,sigma1)
qqplot(q_theo,MaxARestit$Emid,xlim = c(0,3),ylim=c(0,4),col="blue",ylab="Stage error [m]")
abline(a=0,b=1, col="red")
#LN FIT 3/D
mu3 = mean(log(MaxARestit$Ethree)[which(log(MaxARestit$Ethree)!=-Inf)])
sigma3 = sd(log(MaxARestit$Ethree)[which(log(MaxARestit$Ethree)!=-Inf)])
hist(MaxARestit$Ethree,prob = T,ylim=c(0,15),main = "LogNorm 3/d",
breaks = br,xlab = "Stage error [m]")
ytheo = dlnorm(xtheo,mu3,sigma3)
lines(xtheo, ytheo,col="blue",lwd=3)
q_theo=qlnorm((1:length(MaxARestit$Ethree))/length(MaxARestit$Ethree),mu3,sigma3)
qqplot(q_theo,MaxARestit$Ethree,xlim = c(0,1),ylim=c(0,1),col="blue",ylab="Stage error [m]")
abline(a=0,b=1, col="red")
